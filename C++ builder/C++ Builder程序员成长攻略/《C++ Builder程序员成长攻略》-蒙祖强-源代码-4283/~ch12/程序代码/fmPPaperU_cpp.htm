<html>
<head>
<title>fmPPaperU.cpp</title>
</head>
<!-- Generated by TextRush -->
<body text="#000000" bgcolor="#FFFFFF">
<pre>
<code><font  size=3 face="Fixedsys"><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">#include </font><font color="#000080">&lt;</font>vcl<font color="#000080">.</font>h<font color="#000080">&gt;
</font><font color="#0000FF">#pragma </font>hdrstop

<font color="#0000FF">#include </font><font color="#800000">&quot;fmPPaperU.h&quot;
</font><font color="#0000FF">#include </font><font color="#800000">&quot;dmDataU.h&quot;
</font><font color="#0000FF">#include </font><font color="#800000">&quot;SysFuncs.h&quot;
</font><font color="#0000FF">#include </font><font color="#800000">&quot;fmUpdateU.h&quot;
</font><font color="#0000FF">#include </font><font color="#000080">&lt;</font>string<font color="#000080">.</font>h<font color="#000080">&gt;
</font><font color="#0000FF">#include </font><font color="#800000">&quot;fmMainU.h&quot;
</font><font color="#0000FF">#include </font><font color="#800000">&quot;fmInitFileNoU.h&quot;
</font><font color="#008000">//---------------------------------------------------------------------------
</font><font color="#0000FF">#pragma </font>package<font color="#000080">(</font>smart_init<font color="#000080">)
</font><font color="#0000FF">#pragma </font>link <font color="#800000">&quot;fmVBaseU&quot;
</font><font color="#0000FF">#pragma </font>resource <font color="#800000">&quot;*.dfm&quot;
</font>TfmPPaper <font color="#000080">*</font>fmPPaper<font color="#000080">;
</font><font color="#008000">//---------------------------------------------------------------------------
</font><font color="#0000FF">__fastcall </font>TfmPPaper<font color="#000080">::</font>TfmPPaper<font color="#000080">(</font>TComponent <font color="#000080">*</font>Owner<font color="#000080">): </font>TfmVBase<font color="#000080">(</font>Owner<font color="#000080">){}
</font><font color="#008000">//---------------------------------------------------------------------------
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>FormActivate<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font>AnsiString sSql<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);

    </font>TADOQuery <font color="#000080">*</font>qryPropertry<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font>FillCB<font color="#000080">(</font>cmbTaxType<font color="#000080">, </font>qryPropertry<font color="#000080">, </font><font color="#800000">&quot;A_TaxType&quot;</font><font color="#000080">, </font><font color="#800000">&quot;TaxType&quot;</font><font color="#000080">, </font><font color="#800000">&quot;&quot;</font><font color="#000080">);
        </font><font color="#008000">//填充   契税种类   组合框
    </font>FillCB<font color="#000080">(</font>cmbTaxRace<font color="#000080">, </font>qryPropertry<font color="#000080">, </font><font color="#800000">&quot;A_TaxRace&quot;</font><font color="#000080">, </font><font color="#800000">&quot;TaxRace&quot;</font><font color="#000080">, </font><font color="#800000">&quot;&quot;</font><font color="#000080">);
        </font><font color="#008000">//填充   契税税率 组合框
    </font>FillCB<font color="#000080">(</font>cmbMaker<font color="#000080">, </font>qryPropertry<font color="#000080">, </font><font color="#800000">&quot;A_Marker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;Marker&quot;</font><font color="#000080">);
    </font>FillCB<font color="#000080">(</font>cmbChecker<font color="#000080">, </font>qryPropertry<font color="#000080">, </font><font color="#800000">&quot;A_Checker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;Checker&quot;</font><font color="#000080">);
    </font>FillCB<font color="#000080">(</font>cmbManageUnit<font color="#000080">, </font>qryPropertry<font color="#000080">, </font><font color="#800000">&quot;A_ManageUnit&quot;</font><font color="#000080">, </font><font color="#800000">&quot;ManageUnit&quot;</font><font color="#000080">);

    </font>ToolButton6<font color="#000080">-&gt;</font>Enabled <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//提交按钮
    </font>qryIndex<font color="#000080">-&gt;</font>Active <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">;
    </font>qryMain<font color="#000080">-&gt;</font>Active <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">;
    </font>tableOwner<font color="#000080">-&gt;</font>Active <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">;
    </font>ControlReadOnlyFun<font color="#000080">();

    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select * from InitFileNo&quot;</font><font color="#000080">;
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);


    </font><font color="#0000FF">if </font><font color="#000080">(</font>q<font color="#000080">-&gt;</font>RecordCount <font color="#000080">&gt; </font><font color="#800080">0</font><font color="#000080">)
    {
        </font><font color="#0000FF">return </font><font color="#000080">;
    }
    </font>Application<font color="#000080">-&gt;</font>CreateForm<font color="#000080">(</font><font color="#0000FF">__classid</font><font color="#000080">(</font>TfmInitFileNo<font color="#000080">), &amp;</font>fmInitFileNo<font color="#000080">);
    </font>fmInitFileNo<font color="#000080">-&gt;</font>ShowModal<font color="#000080">();



}

</font><font color="#008000">//---------------------------------------------------------------------------
//执行添加按钮代码
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>actAddExecute<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font>AnsiString sSql<font color="#000080">;
    </font>AnsiString sPaper_NO<font color="#000080">;
    </font>ClearFormFun<font color="#000080">();
    </font><font color="#008000">//产生一个房产证号  房产证的长度为10
    </font>sPaper_NO <font color="#000080">= </font>CreatePaper_NOFun<font color="#000080">();
    </font>edtPaper_No<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>sPaper_NO<font color="#000080">;

    </font>ToolButton6<font color="#000080">-&gt;</font>Enabled <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">; </font><font color="#008000">//提交按钮
    </font>ControlWriteFun<font color="#000080">();
}

</font><font color="#008000">//---------------------------------------------------------------------------
//执行提交按钮代码
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>actPostExecute<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font><font color="#0000FF">int </font>nOwnerID<font color="#000080">; </font><font color="#008000">//所有权人ID
    </font><font color="#0000FF">int </font>nPropertyRightID<font color="#000080">; </font><font color="#008000">//所有权性质ID
    </font><font color="#0000FF">int </font>nTaxTypeID<font color="#000080">; </font><font color="#008000">// 契税种类ID
    </font><font color="#0000FF">int </font>nTaxRaceID<font color="#000080">; </font><font color="#008000">//契税税率ID
    </font>AnsiString sSql<font color="#000080">;

    </font><font color="#0000FF">if </font><font color="#000080">(</font>EnsureDatAvalidFun<font color="#000080">() == </font><font color="#0000FF">false</font><font color="#000080">)
    {
        </font><font color="#0000FF">return </font><font color="#000080">;
    }
    </font><font color="#008000">//把产权人信息输入到产权人表  p_Owner  中去
    </font>tableOwner<font color="#000080">-&gt;</font>Active <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">;
    </font>InsertOwnerFun<font color="#000080">(</font>edtOwner<font color="#000080">-&gt;</font>Text<font color="#000080">, </font><font color="#800080">1</font><font color="#000080">);

    </font><font color="#008000">//把共有权人信息输入到产权人表  P_Owner  中去
    //TStringList *SListNameList = new TStringList();
    //SListNameList = GetOwnerNames(edtOwnerList-&gt;Text);//获取共有权人的列表


    //把房屋状况添加到房屋状况表中去
    </font>InsertHoursePropertyFun<font color="#000080">();

    </font><font color="#008000">//把共有权信息插入到  ShareProperty_Paper 共有权证表。
    </font>InsertSharePropertyFun<font color="#000080">();

    </font><font color="#008000">//把契税摘要信息插入到 契税摘要表 P_Contract_Tax  中去
    </font>InsertContract_TaxFun<font color="#000080">();

    </font><font color="#008000">//把他项权利信息插入到他项权利摘要表  P_OtherProperty  中去
    </font>InsertOtherPropertyFun<font color="#000080">();

    </font><font color="#008000">//把国有土地信息插入到国有土地使用表  GroundProperty 中去
    </font>InsertGroundPropertyFun<font color="#000080">();

    </font><font color="#008000">//把房屋所有权证信息插入到房屋所有权证表  Property_Paper  中。
    </font>InsertPropertyPaperFun<font color="#000080">();
    </font>ToolButton6<font color="#000080">-&gt;</font>Enabled <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//提交按钮
    </font>ControlReadOnlyFun<font color="#000080">();
    </font>qryIndex<font color="#000080">-&gt;</font>Close<font color="#000080">();
    </font>qryIndex<font color="#000080">-&gt;</font>Open<font color="#000080">();
    </font>tableOwner<font color="#000080">-&gt;</font>Active <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">;



}

</font><font color="#008000">//--------------------------------------------------------------------------
/*自定义函数*/
/*函数功能: 把共有权人姓名字符串拆分出姓名列表*/
/*参数说明：
AnsiString sOwnerNames：共有有权人的姓名字符串
 */
</font>TStringList <font color="#000080">*</font><font color="#0000FF">__fastcall </font>TfmPPaper<font color="#000080">::</font>GetOwnerNames<font color="#000080">(</font>AnsiString sOwnerNames<font color="#000080">)
{
    </font><font color="#0000FF">int </font>nNamesLength<font color="#000080">;
    </font><font color="#0000FF">int </font>nPos<font color="#000080">;
    </font>AnsiString sName<font color="#000080">;
    </font>TStringList <font color="#000080">*</font>SListNameList <font color="#000080">= </font><font color="#0000FF">new </font>TStringList<font color="#000080">();

    </font><font color="#0000FF">while </font><font color="#000080">(</font>sOwnerNames<font color="#000080">.</font>Length<font color="#000080">() &gt; </font><font color="#800080">0</font><font color="#000080">)
    {
        </font>sOwnerNames <font color="#000080">= </font>sOwnerNames<font color="#000080">.</font>TrimLeft<font color="#000080">();
        </font>sOwnerNames <font color="#000080">= </font>sOwnerNames<font color="#000080">.</font>TrimRight<font color="#000080">();
        </font>nPos <font color="#000080">= </font>sOwnerNames<font color="#000080">.</font>Pos<font color="#000080">(</font><font color="#800000">&quot; &quot;</font><font color="#000080">);
        </font><font color="#0000FF">if </font><font color="#000080">(</font>nPos <font color="#000080">== </font><font color="#800080">0</font><font color="#000080">)
        {
            </font>SListNameList<font color="#000080">-&gt;</font>Add<font color="#000080">(</font>sOwnerNames<font color="#000080">);
            </font><font color="#0000FF">break</font><font color="#000080">;
        }
        </font>sName <font color="#000080">= </font>sOwnerNames<font color="#000080">.</font>SubString<font color="#000080">(</font><font color="#800080">1</font><font color="#000080">, </font>nPos<font color="#000080">);
        </font>sName <font color="#000080">= </font>sName<font color="#000080">.</font>Trim<font color="#000080">();
        </font>SListNameList<font color="#000080">-&gt;</font>Add<font color="#000080">(</font>sName<font color="#000080">);
        </font>sOwnerNames <font color="#000080">= </font>sOwnerNames<font color="#000080">.</font>SubString<font color="#000080">(</font>nPos<font color="#000080">, </font>sOwnerNames<font color="#000080">.</font>Length<font color="#000080">());
    }
    </font><font color="#0000FF">return </font>SListNameList<font color="#000080">;


}

</font><font color="#008000">//---------------------------------------------------------------------------
/*自定义函数
函数功能: 把所有权人、共有权人信息输入到产权人表P_Owner中去
参数说明：
AnsiString sOwnerName ---所有权人的姓名
int nPropertyFlag     ---所有权人的性质
nPropertyFlag=1;代表所有权人
nPropertyFlag=2；代表共有权人
返回值说明：
返回所有权人或共有权人的ID
 */
</font><font color="#0000FF">int __fastcall </font>TfmPPaper<font color="#000080">::</font>InsertOwnerFun<font color="#000080">(</font>AnsiString sOwnerName<font color="#000080">, </font><font color="#0000FF">int
    </font>nPropertyFlag<font color="#000080">)
{
    </font><font color="#0000FF">int </font>nPropertyRightID<font color="#000080">; </font><font color="#008000">//所有权性质ID
    </font><font color="#0000FF">int </font>nOwnerID<font color="#000080">; </font><font color="#008000">//所有权人ID
    </font>AnsiString sSql<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);


    </font>nOwnerID <font color="#000080">= </font>GetMaxRecId<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;P_Owner&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RNO&quot;</font><font color="#000080">, </font><font color="#800000">&quot;0&quot;</font><font color="#000080">) + </font><font color="#800080">1</font><font color="#000080">; </font><font color="#008000">//产生一个产权人ID

    //获取所有权性质
    </font><font color="#0000FF">if </font><font color="#000080">(</font>nPropertyFlag <font color="#000080">== </font><font color="#800080">1</font><font color="#000080">)
    {
        </font>sSql <font color="#000080">=
            </font><font color="#800000">&quot;select K_PropertyRight_ID from A_PropertyRight where PropertyRight='&quot; </font><font color="#000080">+ </font>sOwnerName<font color="#000080">.</font>Trim<font color="#000080">() + </font><font color="#800000">&quot;'&quot;</font><font color="#000080">;
    }
    </font><font color="#0000FF">if </font><font color="#000080">(</font>nPropertyFlag <font color="#000080">== </font><font color="#800080">2</font><font color="#000080">)
    {
        </font>sSql <font color="#000080">=
            </font><font color="#800000">&quot;select K_PropertyRight_ID from A_PropertyRight where PropertyRight='共有人'&quot;</font><font color="#000080">;
    }
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    </font><font color="#0000FF">if </font><font color="#000080">(</font>q<font color="#000080">-&gt;</font>RecordCount <font color="#000080">&gt; </font><font color="#800080">0</font><font color="#000080">)
    {
        </font>nPropertyRightID <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_PropertyRight_ID&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;
    }
    </font><font color="#008000">//把产权人加入到产权人表中去
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;insert into P_Owner values(&quot;</font><font color="#000080">;
    </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nOwnerID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//ID
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>sOwnerName <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//产权人姓名
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'#',&quot;</font><font color="#000080">; </font><font color="#008000">//产权人性别
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;0,&quot;</font><font color="#000080">; </font><font color="#008000">//产权人年龄
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'#',&quot;</font><font color="#000080">; </font><font color="#008000">//产权人籍贯
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'#',&quot;</font><font color="#000080">; </font><font color="#008000">//产权人住址
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'#',&quot;</font><font color="#000080">; </font><font color="#008000">//产权人工作单位
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'#',&quot;</font><font color="#000080">; </font><font color="#008000">//产权人职业
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'#',&quot;</font><font color="#000080">; </font><font color="#008000">//产权人关系
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;0.0,&quot;</font><font color="#000080">; </font><font color="#008000">//应占份数
    </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nPropertyRightID<font color="#000080">) + </font><font color="#800000">&quot;)&quot;</font><font color="#000080">; </font><font color="#008000">//所有权性质
    </font>ExecuteSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    </font><font color="#0000FF">return </font>nOwnerID<font color="#000080">;
}

</font><font color="#008000">/*
自定义函数
函数功能：把房屋状况添加到房屋状况表中去
判断在gridPropertyHourse控件中的房屋状况：如果房屋所有的属性为空，则认为不存在该房屋---gridPropertyHourse控件

 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>InsertHoursePropertyFun<font color="#000080">()

{
    </font><font color="#0000FF">int </font>nHourseNum <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
    </font>AnsiString sSql<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);

    </font><font color="#008000">//获取房子栋数
    </font>nHourseNum <font color="#000080">= </font>getBuildingNumFun<font color="#000080">();


    </font><font color="#008000">//把每一栋房子添加到数据库表   P_HouseProperty屋状况表   中去
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>nHourseNum<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font>sSql <font color="#000080">= </font><font color="#800000">&quot;insert into P_HouseProperty values(&quot;</font><font color="#000080">;
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'0',&quot;</font><font color="#000080">; </font><font color="#008000">//ID
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtPaper_No<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//房产证号
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">0</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//栋号
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">1</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//房号
        </font>sSql <font color="#000080">+= </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">2</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//间数
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">3</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//建筑结构
        </font>sSql <font color="#000080">+= </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">4</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//层数
        </font>sSql <font color="#000080">+= </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">5</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//建筑面积
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">6</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;')&quot;</font><font color="#000080">; </font><font color="#008000">//备注
        </font>ExecuteSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    }
}

</font><font color="#008000">//---------------------------------------------------------------------------
/*
自定义函数
函数功能：把共有权证信息添加到    ShareProperty_Paper共有权证表     中去
 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>InsertSharePropertyFun<font color="#000080">()
{
    </font><font color="#0000FF">int </font>nOwnerNum <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
    </font>AnsiString sSql<font color="#000080">;
    </font>TStringList <font color="#000080">*</font>SListIDList <font color="#000080">= </font><font color="#0000FF">new </font>TStringList<font color="#000080">();
    </font>TStringList <font color="#000080">*</font>SListShareList <font color="#000080">= </font><font color="#0000FF">new </font>TStringList<font color="#000080">();
    </font><font color="#0000FF">int </font>nBuildingNum<font color="#000080">;
    </font><font color="#0000FF">int </font>nHourseNum<font color="#000080">;
    </font><font color="#0000FF">float </font>fHourseArea<font color="#000080">;
    </font><font color="#0000FF">int </font>nMarkerID<font color="#000080">;
    </font><font color="#0000FF">int </font>nCheckerID<font color="#000080">;
    </font><font color="#0000FF">int </font>nManageUnitID<font color="#000080">;
    </font>AnsiString sDate<font color="#000080">;

    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font><font color="#008000">//检查共有权人数量
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>gridOwnerList<font color="#000080">-&gt;</font>RowCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">if </font><font color="#000080">(</font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">0</font><font color="#000080">][</font>i<font color="#000080">] != </font><font color="#800000">&quot;&quot;</font><font color="#000080">)
        {
            </font>nOwnerNum<font color="#000080">++;
        }
        </font><font color="#0000FF">else
        </font><font color="#000080">{
            </font><font color="#0000FF">break</font><font color="#000080">;
        }
    }

    </font><font color="#008000">//把共有权人添加到共有权权人表中去，
    //同时返回共有权人ID作为一个ID列表存在SListIDList中
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>nOwnerNum<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">int </font>nID <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
        </font>nID <font color="#000080">= </font>InsertOwnerFun<font color="#000080">(</font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">0</font><font color="#000080">][</font>i<font color="#000080">], </font><font color="#800080">2</font><font color="#000080">);
            </font><font color="#008000">//插入共有人信息输入到产权人表  p_Owner  中去

        </font>SListIDList<font color="#000080">-&gt;</font>Add<font color="#000080">(</font>IntToStr<font color="#000080">(</font>nID<font color="#000080">));
        </font>edtOwnerList<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>edtOwnerList<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">0</font><font color="#000080">][</font>i<font color="#000080">] +
            </font><font color="#800000">&quot;   &quot;</font><font color="#000080">;

    }




    </font><font color="#008000">//获取缮证人 ID
    </font>nMarkerID <font color="#000080">= </font>GetID<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_Marker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font><font color="#800000">&quot;Marker&quot;</font><font color="#000080">, </font>cmbMaker<font color="#000080">-&gt;</font>Text<font color="#000080">);
    </font><font color="#008000">//获取校对人ID
    </font>nCheckerID <font color="#000080">= </font>GetID<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_Checker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font><font color="#800000">&quot;Checker&quot;</font><font color="#000080">, </font>cmbMaker<font color="#000080">-&gt;</font>Text<font color="#000080">);
    </font><font color="#008000">//获取填发机关ID
    </font>nManageUnitID <font color="#000080">= </font>GetID<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_ManageUnit&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font><font color="#800000">&quot;ManageUnit&quot;</font><font color="#000080">, </font>cmbManageUnit
        <font color="#000080">-&gt;</font>Text<font color="#000080">);
    </font><font color="#008000">//获取栋数
    </font>nBuildingNum <font color="#000080">= </font>getBuildingNumFun<font color="#000080">();
    </font><font color="#008000">//获取间数
    </font>nHourseNum <font color="#000080">= </font>getHourseNumFun<font color="#000080">();
    </font><font color="#008000">//获取建筑面积
    </font>fHourseArea <font color="#000080">= </font>getHourseAreaFun<font color="#000080">();
    </font><font color="#008000">//获取日期
    </font>sDate <font color="#000080">= </font>FormatDateTime<font color="#000080">(</font><font color="#800000">&quot;YYYY.MM.DD&quot;</font><font color="#000080">, </font>dataSendOutDate<font color="#000080">-&gt;</font>Date<font color="#000080">);
    </font><font color="#008000">//把每一个共有权证信息保存到ShareProperty_Paper 共有权证表。
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>nOwnerNum<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#008000">//产生共有权证号 ,把共有权证号列表存在SListShareList中
        </font>AnsiString sShare_ID<font color="#000080">;
        </font>sShare_ID <font color="#000080">= </font>CreateShareProperty_NOFun<font color="#000080">();

        </font>SListShareList<font color="#000080">-&gt;</font>Add<font color="#000080">(</font>sShare_ID<font color="#000080">);
        </font>sSql <font color="#000080">= </font><font color="#800000">&quot;insert into ShareProperty_Paper values(&quot;</font><font color="#000080">;
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'0',&quot;</font><font color="#000080">; </font><font color="#008000">//ID
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtPaper_No<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//所有权证编号
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>SListShareList<font color="#000080">-&gt;</font>Strings<font color="#000080">[</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//共有权证号
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>SListIDList<font color="#000080">-&gt;</font>Strings<font color="#000080">[</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">// 共有人编号
        </font>sSql <font color="#000080">+= </font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">1</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//共有份额
        </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nBuildingNum<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//栋数
        </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nHourseNum<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//间数
        </font>sSql <font color="#000080">+= </font>FloatToStr<font color="#000080">(</font>fHourseArea<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//建筑面积
        </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nMarkerID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//缮证人
        </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nCheckerID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//校对人
        </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nManageUnitID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//填发机关
        </font>sSql <font color="#000080">+=  + </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>sDate <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//填发日期
        </font>sSql <font color="#000080">+=  + </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>sDate <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//领证日期
        </font>sSql <font color="#000080">+=  + </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">3</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;')&quot;</font><font color="#000080">; </font><font color="#008000">//备注

        </font>ExecuteSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    }

}

</font><font color="#008000">//---------------------------------------------------------------------------

/*
自定义函数：
函数说明：
把契税摘要信息插入到 契税摘要表 P_Contract_Tax  中去
 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>InsertContract_TaxFun<font color="#000080">()
{
    </font><font color="#0000FF">int </font>nTaxType_ID <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
    </font><font color="#0000FF">int </font>nTaxRace_ID <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
    </font><font color="#0000FF">int </font>nRNO<font color="#000080">;
    </font>AnsiString sSql<font color="#000080">;
    </font>AnsiString sDate<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font><font color="#0000FF">if </font><font color="#000080">((</font>EdtPrice<font color="#000080">-&gt;</font>Text <font color="#000080">== </font><font color="#800000">&quot;&quot;</font><font color="#000080">) || (</font>cmbTaxType<font color="#000080">-&gt;</font>Text <font color="#000080">== </font><font color="#800000">&quot;&quot;</font><font color="#000080">) || (</font>cmbTaxRace<font color="#000080">-&gt;</font>Text
        <font color="#000080">== </font><font color="#800000">&quot;&quot;</font><font color="#000080">) || (</font>edtTax<font color="#000080">-&gt;</font>Text <font color="#000080">== </font><font color="#800000">&quot;&quot;</font><font color="#000080">))
    {
        </font><font color="#0000FF">return </font><font color="#000080">;
    }
    </font><font color="#008000">//获取契税种类ID
    </font>nTaxType_ID <font color="#000080">= </font>GetID<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_TaxType&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font><font color="#800000">&quot;TaxType&quot;</font><font color="#000080">, </font>cmbTaxType<font color="#000080">-&gt;</font>Text<font color="#000080">);

    </font><font color="#008000">//获取契税税率ID
    </font>nTaxRace_ID <font color="#000080">= </font>GetID<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_TaxRace&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font><font color="#800000">&quot;TaxRace&quot;</font><font color="#000080">, </font>cmbTaxRace<font color="#000080">-&gt;</font>Text<font color="#000080">);

    </font><font color="#008000">//获取日期
    </font>sDate <font color="#000080">= </font>FormatDateTime<font color="#000080">(</font><font color="#800000">&quot;YYYY.MM.DD&quot;</font><font color="#000080">, </font>dataStartData<font color="#000080">-&gt;</font>Date<font color="#000080">);
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;insert into P_Contract_Tax values(&quot;</font><font color="#000080">;
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'0',&quot;</font><font color="#000080">; </font><font color="#008000">//唯一的内部编号
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtPaper_No<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//所有权证编号
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>sDate <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//立契日期
    </font>sSql <font color="#000080">+= </font>EdtPrice<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//契价
    </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nTaxType_ID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//外键，契税种类
    </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nTaxRace_ID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//外键，契税税率
    </font>sSql <font color="#000080">+= </font>edtTax<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//金额
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtNote<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;')&quot;</font><font color="#000080">; </font><font color="#008000">//备注

    </font>ExecuteSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);

}

</font><font color="#008000">//---------------------------------------------------------------------------

/*
自定义函数
函数说明：
把他项权利信息插入到 P_OtherProperty 他项权利摘要表。
 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>InsertOtherPropertyFun<font color="#000080">()
{
    </font><font color="#0000FF">int </font>nOtherPropertyNum <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
    </font>AnsiString sSql<font color="#000080">;
    </font>AnsiString sDate<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);

    </font><font color="#008000">//检查他项权利数量数量
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>gridOtherProperty<font color="#000080">-&gt;</font>RowCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">if </font><font color="#000080">(</font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">0</font><font color="#000080">][</font>i<font color="#000080">] != </font><font color="#800000">&quot;&quot;</font><font color="#000080">)
        {
            </font>nOtherPropertyNum<font color="#000080">++;
        }
        </font><font color="#0000FF">else
        </font><font color="#000080">{
            </font><font color="#0000FF">break</font><font color="#000080">;
        }
    }

    </font><font color="#008000">//把他项权利信息插入到 P_OtherProperty 他项权利摘要表
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>nOtherPropertyNum<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font>sDate <font color="#000080">= </font>FormatDateTime<font color="#000080">(</font><font color="#800000">&quot;YYYY.MM.DD&quot;</font><font color="#000080">, </font>StrToDateTime<font color="#000080">(</font>gridOtherProperty
            <font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">7</font><font color="#000080">][</font>i<font color="#000080">]));
        </font>sSql <font color="#000080">= </font><font color="#800000">&quot;insert into P_OtherProperty values(&quot;</font><font color="#000080">;
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'0',&quot;</font><font color="#000080">; </font><font color="#008000">//唯一的内部编号
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtPaper_No<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//所有权证编号
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">1</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//权利种类
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">0</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//权利人
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'0',&quot;</font><font color="#000080">; </font><font color="#008000">//房屋编号
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">2</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//房号
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">3</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//间数
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">4</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">;
        ; </font><font color="#008000">//建筑面积
        </font>sSql <font color="#000080">+= </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">5</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">;
        ; </font><font color="#008000">//权利价值
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">6</font><font color="#000080">][</font>i<font color="#000080">] + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">;
        ; </font><font color="#008000">//存续期限
        </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>sDate <font color="#000080">+ </font><font color="#800000">&quot;')&quot;</font><font color="#000080">;
        ; </font><font color="#008000">//注销日期

        </font>ExecuteSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);

    }

}

</font><font color="#008000">//-------------------------------------------------------------------------
/*
自定义函数
函数说明：
//把国有土地信息插入到国有土地使用表  GroundProperty 中去
 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>InsertGroundPropertyFun<font color="#000080">()
{
    </font>AnsiString sSql<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font><font color="#0000FF">if </font><font color="#000080">(</font>edtUsedAreaM2<font color="#000080">-&gt;</font>Text <font color="#000080">== </font><font color="#800000">&quot;&quot; </font><font color="#000080">|| </font>edtUsedArea<font color="#000080">-&gt;</font>Text <font color="#000080">== </font><font color="#800000">&quot;&quot; </font><font color="#000080">|| </font>edtFileNo<font color="#000080">-&gt;</font>Text
        <font color="#000080">== </font><font color="#800000">&quot;&quot;</font><font color="#000080">)
    {
        </font><font color="#0000FF">return </font><font color="#000080">;
    }
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;insert into P_GroundProperty values(&quot;</font><font color="#000080">;
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'0',&quot;</font><font color="#000080">; </font><font color="#008000">// 唯一的内部编号
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtPaper_No<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">// 所有权证编号
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'桂房证',&quot;</font><font color="#000080">; </font><font color="#008000">// 土地使用证字
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtFileNo<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">// 土地使用证号
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtUsedAreaM2<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">// 使用国有土地面积（平方米）
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtUsedArea<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;')&quot;</font><font color="#000080">; </font><font color="#008000">// 使用国有土地面积（亩）
    </font>ExecuteSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);

}

</font><font color="#008000">//-------------------------------------------------------------------------
/*
自定义函数
函数说明：
//把国有土地信息插入到国有土地使用表  GroundProperty 中去
 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>InsertPropertyPaperFun<font color="#000080">()
{
    </font><font color="#0000FF">int </font>nOwnerID<font color="#000080">; </font><font color="#008000">//所有权人ID
    </font><font color="#0000FF">int </font>nPropertyRightID<font color="#000080">;
    </font><font color="#0000FF">int </font>nManageUnitID<font color="#000080">;
    </font><font color="#0000FF">int </font>nMarkerID<font color="#000080">;
    </font><font color="#0000FF">int </font>nCheckerID<font color="#000080">;
    </font>AnsiString sSql<font color="#000080">;
    </font>AnsiString sDate<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);

    </font><font color="#008000">//获取所有权性质
    </font>sSql <font color="#000080">=
        </font><font color="#800000">&quot;select K_PropertyRight_ID from A_PropertyRight where PropertyRight='&quot;
        </font><font color="#000080">+ </font>edtPropertyRight<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;'&quot;</font><font color="#000080">;
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    </font><font color="#0000FF">if </font><font color="#000080">(</font>q<font color="#000080">-&gt;</font>RecordCount <font color="#000080">&gt; </font><font color="#800080">0</font><font color="#000080">)
    {
        </font>nPropertyRightID <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_PropertyRight_ID&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;
    }
    </font><font color="#008000">//获取填发机关ID
    </font>nManageUnitID <font color="#000080">= </font>GetID<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_ManageUnit&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font><font color="#800000">&quot;ManageUnit&quot;</font><font color="#000080">, </font>cmbManageUnit
        <font color="#000080">-&gt;</font>Text<font color="#000080">);

    </font><font color="#008000">//获取缮证人 ID
    </font>nMarkerID <font color="#000080">= </font>GetID<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_Marker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font><font color="#800000">&quot;Marker&quot;</font><font color="#000080">, </font>cmbMaker<font color="#000080">-&gt;</font>Text<font color="#000080">);
    </font><font color="#008000">//获取校对人ID
    </font>nCheckerID <font color="#000080">= </font>GetID<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_Checker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font><font color="#800000">&quot;Checker&quot;</font><font color="#000080">, </font>cmbChecker<font color="#000080">-&gt;</font>Text<font color="#000080">);
    </font><font color="#008000">//获取日期
    </font>sDate <font color="#000080">= </font>FormatDateTime<font color="#000080">(</font><font color="#800000">&quot;YYYY.MM.DD&quot;</font><font color="#000080">, </font>dataSendOutDate<font color="#000080">-&gt;</font>Date<font color="#000080">);
    </font>nOwnerID <font color="#000080">= </font>GetMaxRecId<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;P_Owner&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RNO&quot;</font><font color="#000080">, </font><font color="#800000">&quot;0&quot;</font><font color="#000080">) + </font><font color="#800080">1</font><font color="#000080">; </font><font color="#008000">//产生一个产权人ID
    </font>InsertOwnerFun<font color="#000080">(</font>edtOwner<font color="#000080">-&gt;</font>Text<font color="#000080">, </font><font color="#800080">1</font><font color="#000080">);
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;insert into Property_Paper values(&quot;</font><font color="#000080">;
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'0',&quot;</font><font color="#000080">;
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'桂房证',&quot;</font><font color="#000080">;

    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtPaper_No<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">// 房产证号;

    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'0',&quot;</font><font color="#000080">; </font><font color="#008000">// 申请审批表编号
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>IntToStr<font color="#000080">(</font>nOwnerID<font color="#000080">) + </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">// 所有权人编号
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtOwnerList<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//共有人
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtPosition<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//房屋座落;
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>edtGround_No<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//地号
    </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nPropertyRightID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">// 所有权性质
    </font>sSql <font color="#000080">+= </font><font color="#800000">&quot;'0',&quot;</font><font color="#000080">; </font><font color="#008000">// 状态
    </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nManageUnitID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">// 填发机关
    </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nMarkerID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//缮证人
    </font>sSql <font color="#000080">+= </font>IntToStr<font color="#000080">(</font>nCheckerID<font color="#000080">) + </font><font color="#800000">&quot;,&quot;</font><font color="#000080">; </font><font color="#008000">//校对人
    </font>sSql <font color="#000080">+=  + </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>sDate <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//填发日期
    </font>sSql <font color="#000080">+=  + </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>sDate <font color="#000080">+ </font><font color="#800000">&quot;',&quot;</font><font color="#000080">; </font><font color="#008000">//领证日期
    </font>sSql <font color="#000080">+=  + </font><font color="#800000">&quot;'&quot; </font><font color="#000080">+ </font>memRemark<font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;')&quot;</font><font color="#000080">; </font><font color="#008000">//附记

    </font>ExecuteSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
}

</font><font color="#008000">//---------------------------------------------------------------------------
/*
自定义函数
函数说明：
产生一个房产证号  房产证的长度为10：
 */
</font>AnsiString <font color="#0000FF">__fastcall </font>TfmPPaper<font color="#000080">::</font>CreatePaper_NOFun<font color="#000080">()
{
    </font><font color="#008000">/*int i, iLength;
    AnsiString  sPaper_NO;
    iLength = dmData-&gt;GetAValue(&quot;select top 1 FileNOLength from InitFileNo&quot;);
    sPaper_NO = dmData-&gt;GetAValue(&quot;select top 1 Paper_NO from Property_Paper order by Paper_NO desc&quot;);
    if (sPaper_NO == &quot;&quot;)
    {
    sPaper_NO = dmData-&gt;GetAValue(&quot;select top 1 isnull(FileNOStart, '0') from InitFileNo&quot;);
    }
    sPaper_NO = IntToStr(StrToInt(sPaper_NO) + 1);
    while(sPaper_NO.Length() &lt; iLength)
    {
    sPaper_NO = &quot;0&quot; + sPaper_NO;
    }
    return sPaper_NO;
     */


    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font>AnsiString sSql<font color="#000080">;
    </font>AnsiString sPaper_NO<font color="#000080">;
    </font><font color="#0000FF">int </font>nFileNoLength<font color="#000080">;



    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select * from InitFileNo&quot;</font><font color="#000080">;
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);

    </font><font color="#0000FF">if </font><font color="#000080">(</font>q<font color="#000080">-&gt;</font>RecordCount <font color="#000080">&gt; </font><font color="#800080">0</font><font color="#000080">)
    {
        </font>sPaper_NO <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;FileNoStart&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
        </font>nFileNoLength <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;FileNoLength&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;
        </font>sPaper_NO <font color="#000080">= </font>sPaper_NO<font color="#000080">.</font>Trim<font color="#000080">();
        </font>sPaper_NO <font color="#000080">= </font>IntToStr<font color="#000080">((</font>StrToInt<font color="#000080">(</font>sPaper_NO<font color="#000080">) + </font><font color="#800080">1</font><font color="#000080">));

        </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select Paper_NO from Property_Paper&quot;</font><font color="#000080">;
        </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
        </font>q<font color="#000080">-&gt;</font>First<font color="#000080">();
        </font><font color="#0000FF">if </font><font color="#000080">(</font>q<font color="#000080">-&gt;</font>Eof<font color="#000080">)
        {
            </font><font color="#0000FF">while </font><font color="#000080">(</font>sPaper_NO<font color="#000080">.</font>Length<font color="#000080">() &lt; </font>nFileNoLength<font color="#000080">)
            {
                </font>sPaper_NO <font color="#000080">= </font><font color="#800000">&quot;0&quot; </font><font color="#000080">+ </font>sPaper_NO<font color="#000080">;
            }
            </font><font color="#0000FF">return </font>sPaper_NO<font color="#000080">;

        }
    }
    </font><font color="#0000FF">else
    </font><font color="#000080">{
        </font>sPaper_NO <font color="#000080">= </font><font color="#800000">&quot;0000000000&quot;</font><font color="#000080">;
        </font>nFileNoLength <font color="#000080">= </font><font color="#800080">10</font><font color="#000080">;
    }

    </font><font color="#008000">//sSql = &quot;select Paper_NO from Property_Paper&quot;;
    //ResultSql(q,sSql);
    </font>q<font color="#000080">-&gt;</font>First<font color="#000080">();

    </font><font color="#0000FF">while </font><font color="#000080">(!</font>q<font color="#000080">-&gt;</font>Eof<font color="#000080">)
    {
        </font>AnsiString sNO_Buf<font color="#000080">;
        </font>sNO_Buf <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
        </font><font color="#0000FF">if </font><font color="#000080">(</font>strcmp<font color="#000080">(</font>sNO_Buf<font color="#000080">.</font>c_str<font color="#000080">(), </font>sPaper_NO<font color="#000080">.</font>c_str<font color="#000080">()))
        {
            </font>sPaper_NO <font color="#000080">= </font>sNO_Buf<font color="#000080">;
        }
        </font>q<font color="#000080">-&gt;</font>Next<font color="#000080">();
    }

    </font><font color="#0000FF">while </font><font color="#000080">(</font>sPaper_NO<font color="#000080">.</font>Length<font color="#000080">() &gt; </font><font color="#800080">0 </font><font color="#000080">&amp;&amp; </font>sPaper_NO<font color="#000080">.</font>SubString<font color="#000080">(</font><font color="#800080">1</font><font color="#000080">, </font><font color="#800080">1</font><font color="#000080">) != </font><font color="#800000">&quot;0&quot;</font><font color="#000080">)
    {
        </font>sPaper_NO <font color="#000080">= </font>sPaper_NO<font color="#000080">.</font>SubString<font color="#000080">(</font><font color="#800080">2</font><font color="#000080">, </font>sPaper_NO<font color="#000080">.</font>Length<font color="#000080">());
    }

    </font>sPaper_NO <font color="#000080">= </font>IntToStr<font color="#000080">((</font>StrToInt<font color="#000080">(</font>sPaper_NO<font color="#000080">) + </font><font color="#800080">1</font><font color="#000080">));
    </font><font color="#0000FF">while </font><font color="#000080">(</font>sPaper_NO<font color="#000080">.</font>Length<font color="#000080">() &lt; </font>nFileNoLength<font color="#000080">)
    {
        </font>sPaper_NO <font color="#000080">= </font><font color="#800000">&quot;0&quot; </font><font color="#000080">+ </font>sPaper_NO<font color="#000080">;
    }
    </font><font color="#0000FF">return </font>sPaper_NO<font color="#000080">;

}

</font><font color="#008000">//---------------------------------------------------------------------------
/*
自定义函数
函数说明：
产生一个共有权证号  共有权的长度为10：
 */
</font>AnsiString <font color="#0000FF">__fastcall </font>TfmPPaper<font color="#000080">::</font>CreateShareProperty_NOFun<font color="#000080">()
{
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font>AnsiString sSql<font color="#000080">;
    </font>AnsiString sShareProperty_NO<font color="#000080">;
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select ShareProperty_Paper_NO from ShareProperty_Paper&quot;</font><font color="#000080">;
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    </font>q<font color="#000080">-&gt;</font>First<font color="#000080">();
    </font>sShareProperty_NO <font color="#000080">= </font><font color="#800000">&quot;0000000000&quot;</font><font color="#000080">;
    </font><font color="#0000FF">while </font><font color="#000080">(!</font>q<font color="#000080">-&gt;</font>Eof<font color="#000080">)
    {
        </font>AnsiString sNO_Buf<font color="#000080">;

        </font>sNO_Buf <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;ShareProperty_Paper_NO&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;

        </font><font color="#0000FF">if </font><font color="#000080">(</font>strcmp<font color="#000080">(</font>sNO_Buf<font color="#000080">.</font>c_str<font color="#000080">(), </font>sShareProperty_NO<font color="#000080">.</font>c_str<font color="#000080">()))
        {
            </font>sShareProperty_NO <font color="#000080">= </font>sNO_Buf<font color="#000080">;
        }
        </font>q<font color="#000080">-&gt;</font>Next<font color="#000080">();
    }
    </font><font color="#0000FF">while </font><font color="#000080">(</font>sShareProperty_NO<font color="#000080">.</font>Length<font color="#000080">() &gt; </font><font color="#800080">0 </font><font color="#000080">&amp;&amp; </font>sShareProperty_NO<font color="#000080">.</font>SubString<font color="#000080">(</font><font color="#800080">1</font><font color="#000080">, </font><font color="#800080">1</font><font color="#000080">)
        != </font><font color="#800000">&quot;0&quot;</font><font color="#000080">)
    {
        </font>sShareProperty_NO <font color="#000080">= </font>sShareProperty_NO<font color="#000080">.</font>SubString<font color="#000080">(</font><font color="#800080">2</font><font color="#000080">,
            </font>sShareProperty_NO<font color="#000080">.</font>Length<font color="#000080">());
    }
    </font>sShareProperty_NO <font color="#000080">= </font>IntToStr<font color="#000080">((</font>StrToInt<font color="#000080">(</font>sShareProperty_NO<font color="#000080">) + </font><font color="#800080">1</font><font color="#000080">));
    </font><font color="#0000FF">while </font><font color="#000080">(</font>sShareProperty_NO<font color="#000080">.</font>Length<font color="#000080">() &lt; </font><font color="#800080">10</font><font color="#000080">)
    {
        </font>sShareProperty_NO <font color="#000080">= </font><font color="#800000">&quot;0&quot; </font><font color="#000080">+ </font>sShareProperty_NO<font color="#000080">;
    }
    </font><font color="#0000FF">return </font>sShareProperty_NO<font color="#000080">;
}

</font><font color="#008000">/*
自定义函数
函数说明：用来获取房子栋数
返回值说明:返回房子栋数
 */
</font><font color="#0000FF">int __fastcall </font>TfmPPaper<font color="#000080">::</font>getBuildingNumFun<font color="#000080">()
{
    </font><font color="#0000FF">int </font>nBuildingNum <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
    </font><font color="#008000">//for循环判断在 gridPropertyHourse中一共有多少栋房子
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>gridPropertyHourse<font color="#000080">-&gt;</font>RowCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>j <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>j <font color="#000080">&lt; </font>gridPropertyHourse<font color="#000080">-&gt;</font>ColCount<font color="#000080">; </font>j<font color="#000080">++)
        {
            </font><font color="#0000FF">if </font><font color="#000080">(</font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font>j<font color="#000080">][</font>i<font color="#000080">] != </font><font color="#800000">&quot;&quot;</font><font color="#000080">)
            {
                </font>nBuildingNum<font color="#000080">++;
                </font><font color="#0000FF">break</font><font color="#000080">;
            }
        }
        </font><font color="#0000FF">if </font><font color="#000080">(</font>nBuildingNum <font color="#000080">!= </font>i <font color="#000080">+ </font><font color="#800080">1</font><font color="#000080">)
        {
            </font><font color="#0000FF">break</font><font color="#000080">;
        }
    }
    </font><font color="#0000FF">return </font>nBuildingNum<font color="#000080">;
}

</font><font color="#008000">//---------------------------------------------------------------------------
/*
自定义函数
函数说明：用来获取房子间数
返回值说明:返回房子间数
 */
</font><font color="#0000FF">int __fastcall </font>TfmPPaper<font color="#000080">::</font>getHourseNumFun<font color="#000080">()
{
    </font><font color="#0000FF">int </font>nHourseNum <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
    </font><font color="#0000FF">int </font>nBuildingNum <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
    </font><font color="#008000">//获取房子栋数
    </font>nBuildingNum <font color="#000080">= </font>getBuildingNumFun<font color="#000080">();
    </font><font color="#008000">//计算房子的总间数

    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>nBuildingNum<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font>nHourseNum <font color="#000080">+= </font>StrToInt<font color="#000080">(</font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">1</font><font color="#000080">][</font>i<font color="#000080">]);

    }
    </font><font color="#0000FF">return </font>nHourseNum<font color="#000080">;
}

</font><font color="#008000">/*
自定义函数
函数说明：用来获取房子总面积
返回值说明:返回房子总面积
 */
//----------------------------------------------------------------------
</font><font color="#0000FF">float __fastcall </font>TfmPPaper<font color="#000080">::</font>getHourseAreaFun<font color="#000080">()
{
    </font><font color="#0000FF">float </font>fHourseArea <font color="#000080">= </font><font color="#8000FF">0.0</font><font color="#000080">;
    </font><font color="#0000FF">int </font>nBuildingNum <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
    </font><font color="#008000">//获取房子栋数
    </font>nBuildingNum <font color="#000080">= </font>getBuildingNumFun<font color="#000080">();
    </font><font color="#008000">//计算房子的总间数
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>nBuildingNum<font color="#000080">; </font>i<font color="#000080">++)
    {

        </font>fHourseArea <font color="#000080">+= </font>StrToFloat<font color="#000080">(</font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">5</font><font color="#000080">][</font>i<font color="#000080">]);
    }
    </font><font color="#0000FF">return </font>fHourseArea<font color="#000080">;
}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>actCancleExecute<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font>ToolButton6<font color="#000080">-&gt;</font>Enabled <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//提交按钮
    </font>ControlReadOnlyFun<font color="#000080">();
}

</font><font color="#008000">//---------------------------------------------------------------------------

/*
/*
自定义函数
函数说明：显示所有权证*/
//---------------------------------------------------------------------------
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>ShowProperty_PaperFun<font color="#000080">()
{
    </font><font color="#0000FF">int </font>nOwnerName<font color="#000080">;
    </font><font color="#0000FF">int </font>nPropertyRight<font color="#000080">;
    </font><font color="#0000FF">int </font>nManageUnit<font color="#000080">;
    </font><font color="#0000FF">int </font>nMarker<font color="#000080">;
    </font><font color="#0000FF">int </font>nChecker<font color="#000080">;
    </font>AnsiString sOwnerId<font color="#000080">;
    </font>AnsiString sOwnerName<font color="#000080">;
    </font>AnsiString sPropertyRight<font color="#000080">;
    </font>AnsiString sManageUnit<font color="#000080">;
    </font>AnsiString sMarker<font color="#000080">;
    </font>AnsiString sChecker<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);

    </font><font color="#008000">//获得所有权人姓名
    </font>sOwnerId <font color="#000080">= (</font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_Owner_NO&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">); </font><font color="#008000">//获得ID
    </font>m_sOwnerID <font color="#000080">= </font>sOwnerId<font color="#000080">;
    </font>sOwnerName <font color="#000080">= </font>GetNameFieldFromIDFieldS<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;P_Owner&quot;</font><font color="#000080">, </font><font color="#800000">&quot;OwnerName&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RNO&quot;</font><font color="#000080">,
        </font>sOwnerId<font color="#000080">);

    </font><font color="#008000">//获得所有权性质
    </font>nPropertyRight <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_PropertyRight_ID&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;
    </font>sPropertyRight <font color="#000080">= </font>GetNameFieldFromIDFieldN<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_PropertyRight&quot;</font><font color="#000080">,
        </font><font color="#800000">&quot;PropertyRight&quot;</font><font color="#000080">, </font><font color="#800000">&quot;K_PropertyRight_ID&quot;</font><font color="#000080">, </font>nPropertyRight<font color="#000080">);

    </font><font color="#008000">//获取填发机关
    </font>nManageUnit <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_ManageUnit_ID&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;

    </font>sManageUnit <font color="#000080">= </font>GetNameFieldFromIDFieldN<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_ManageUnit&quot;</font><font color="#000080">, </font><font color="#800000">&quot;ManageUnit&quot;</font><font color="#000080">,
        </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font>nManageUnit<font color="#000080">);

    </font><font color="#008000">//获取缮证人
    </font>nMarker <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_Maker_ID&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;

    </font>sMarker <font color="#000080">= </font>GetNameFieldFromIDFieldN<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_Marker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;Marker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">, </font>nMarker<font color="#000080">);
    </font><font color="#008000">//获取校对人
    </font>nChecker <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_Checker_ID&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;

    </font>sChecker <font color="#000080">= </font>GetNameFieldFromIDFieldN<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot; A_Checker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;Checker&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">,
        </font>nChecker<font color="#000080">);

    </font><font color="#008000">//显示所有权人姓名
    </font>edtOwner<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>sOwnerName<font color="#000080">;
    </font>edtPaper_No<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
    </font><font color="#008000">//显示所有权性质
    </font>edtPropertyRight<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>sPropertyRight<font color="#000080">;
    </font>edtOwnerList<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;OwnerList&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
    </font>edtPosition<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;House_Position&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
    </font>edtGround_No<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Ground_NO&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
    </font>memRemark<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Remark&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
    </font>cmbMaker<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>sMarker<font color="#000080">;
    </font>cmbChecker<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>sChecker<font color="#000080">; </font><font color="#008000">//SendOutDate
    </font>dataSendOutDate<font color="#000080">-&gt;</font>DateTime <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;SendOutDate&quot;</font><font color="#000080">)
        -&gt;</font>AsDateTime<font color="#000080">;
    </font>cmbManageUnit<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>sManageUnit<font color="#000080">;
}

</font><font color="#008000">/*
自定义函数
函数说明：显示契税摘要
 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>ShowP_Contract_TaxFun<font color="#000080">()
{
    </font><font color="#0000FF">int </font>nTaxType<font color="#000080">;
    </font><font color="#0000FF">int </font>nTaxRace<font color="#000080">;
    </font>AnsiString sTaxType<font color="#000080">;
    </font>AnsiString sTaxRace<font color="#000080">;
    </font>AnsiString sSql<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);


    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select * from P_Contract_Tax where Paper_NO='&quot; </font><font color="#000080">+ </font>edtPaper_No<font color="#000080">-&gt;</font>Text
        <font color="#000080">+ </font><font color="#800000">&quot;'&quot;</font><font color="#000080">;
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    </font><font color="#0000FF">if </font><font color="#000080">(!</font>q<font color="#000080">-&gt;</font>IsEmpty<font color="#000080">())
    {
        </font><font color="#008000">//获取契税种类ID
        </font>nTaxType <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_TaxType_ID&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;
        </font><font color="#008000">//获取契税税率ID
        </font>nTaxRace <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_TaxRace_ID&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;
        </font>EdtPrice<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Price&quot;</font><font color="#000080">)-&gt;</font>AsFloat<font color="#000080">;
        </font>edtTax<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Tax&quot;</font><font color="#000080">)-&gt;</font>AsFloat<font color="#000080">;
        </font>edtNote<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Note&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
        </font><font color="#008000">//获取契税种类
        </font>sTaxType <font color="#000080">= </font>GetNameFieldFromIDFieldN<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_TaxType&quot;</font><font color="#000080">, </font><font color="#800000">&quot;TaxType&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">,
            </font>nTaxType<font color="#000080">);
        </font><font color="#008000">//获取契税税率
        </font>sTaxRace <font color="#000080">= </font>GetNameFieldFromIDFieldN<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;A_TaxRace&quot;</font><font color="#000080">, </font><font color="#800000">&quot;TaxRace&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RID&quot;</font><font color="#000080">,
            </font>nTaxRace<font color="#000080">);
        </font>cmbTaxType<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>sTaxType<font color="#000080">;
        </font>cmbTaxRace<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>sTaxRace<font color="#000080">;
    }
}

</font><font color="#008000">//---------------------------------------------------------------------
/*
自定义函数:
函数说明:
//显示共有权证
 */
</font>TStringList <font color="#000080">*</font><font color="#0000FF">__fastcall </font>TfmPPaper<font color="#000080">::</font>ShowShareProperty_PaperFun<font color="#000080">()
{
    </font><font color="#0000FF">int </font>nOwnerName<font color="#000080">;
    </font>AnsiString sOwnerName<font color="#000080">;
    </font>AnsiString sSql<font color="#000080">;
    </font>TStringList <font color="#000080">*</font>sListOwnerNameId <font color="#000080">= </font><font color="#0000FF">new </font>TStringList<font color="#000080">();
    </font>TStringList <font color="#000080">*</font>sListOwnerName <font color="#000080">= </font><font color="#0000FF">new </font>TStringList<font color="#000080">();
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select * from ShareProperty_Paper where K_Paper_NO='&quot; </font><font color="#000080">+ </font>edtPaper_No
        <font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;'&quot;</font><font color="#000080">;
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);


    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>gridOwnerList<font color="#000080">-&gt;</font>RowCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>j <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>j <font color="#000080">&lt; </font>gridOwnerList<font color="#000080">-&gt;</font>ColCount<font color="#000080">; </font>j<font color="#000080">++)
        {
            </font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font>j<font color="#000080">][</font>i<font color="#000080">] = </font><font color="#800000">&quot;&quot;</font><font color="#000080">;
        }

    }
    </font>q<font color="#000080">-&gt;</font>First<font color="#000080">();
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>q<font color="#000080">-&gt;</font>RecordCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#008000">//获取共有人编号
        </font>nOwnerName <font color="#000080">= </font>StrToInt<font color="#000080">((</font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_Owner_NO&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">));
        </font>sListOwnerNameId<font color="#000080">-&gt;</font>Add<font color="#000080">(</font>IntToStr<font color="#000080">(</font>nOwnerName<font color="#000080">));
        </font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">1</font><font color="#000080">][</font>i<font color="#000080">] = </font>FloatToStr<font color="#000080">(</font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Share&quot;</font><font color="#000080">)
            -&gt;</font>AsFloat<font color="#000080">);
        </font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">2</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;ShareProperty_Paper_NO&quot;</font><font color="#000080">)
            -&gt;</font>AsString<font color="#000080">;
        </font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">3</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Remark&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
        </font>q<font color="#000080">-&gt;</font>Next<font color="#000080">();
    }
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>sListOwnerNameId<font color="#000080">-&gt;</font>Count<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font>nOwnerName <font color="#000080">= </font>StrToInt<font color="#000080">(</font>sListOwnerNameId<font color="#000080">-&gt;</font>Strings<font color="#000080">[</font>i<font color="#000080">]);
        </font>sOwnerName <font color="#000080">= </font>GetNameFieldFromIDFieldN<font color="#000080">(</font>q<font color="#000080">, </font><font color="#800000">&quot;P_Owner&quot;</font><font color="#000080">, </font><font color="#800000">&quot;OwnerName&quot;</font><font color="#000080">, </font><font color="#800000">&quot;RNO&quot;</font><font color="#000080">,
            </font>nOwnerName<font color="#000080">);
        </font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">0</font><font color="#000080">][</font>i<font color="#000080">] = </font>sOwnerName<font color="#000080">;
        </font>sListOwnerName<font color="#000080">-&gt;</font>Add<font color="#000080">(</font>sOwnerName<font color="#000080">);
    }
    </font><font color="#0000FF">return </font>sListOwnerName<font color="#000080">;
}

</font><font color="#008000">/*
自定义函数:
函数说明:
//显示他项权利摘要
 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>ShowP_OtherPropertyFun<font color="#000080">()
{
    </font>AnsiString sSql<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select * from P_OtherProperty where Paper_NO='&quot; </font><font color="#000080">+ </font>edtPaper_No<font color="#000080">-&gt;</font>Text
        <font color="#000080">+ </font><font color="#800000">&quot;'&quot;</font><font color="#000080">;
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    </font><font color="#008000">//清空他项权利摘要StringGrid控件
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>gridOtherProperty<font color="#000080">-&gt;</font>RowCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>j <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>j <font color="#000080">&lt; </font>gridOtherProperty<font color="#000080">-&gt;</font>ColCount<font color="#000080">; </font>j<font color="#000080">++)
        {
            </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font>j<font color="#000080">][</font>i<font color="#000080">] = </font><font color="#800000">&quot;&quot;</font><font color="#000080">;
        }
    }
    </font>q<font color="#000080">-&gt;</font>First<font color="#000080">();
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>q<font color="#000080">-&gt;</font>RecordCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">0</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Obligee&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
            </font><font color="#008000">//权利人
        </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">1</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;PropertyType&quot;</font><font color="#000080">)
            -&gt;</font>AsString<font color="#000080">; </font><font color="#008000">//权利种类
        </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">2</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;K_House_NO&quot;</font><font color="#000080">)
            -&gt;</font>AsString<font color="#000080">; </font><font color="#008000">//房号
        </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">3</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Room&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;
            </font><font color="#008000">//间数
        </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">4</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Structure_Area&quot;</font><font color="#000080">)
            -&gt;</font>AsFloat<font color="#000080">; </font><font color="#008000">//建筑面积
        </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">5</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Pro_Value&quot;</font><font color="#000080">)-&gt;</font>AsFloat<font color="#000080">;
            </font><font color="#008000">//权利价值
        </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">6</font><font color="#000080">][</font>i<font color="#000080">] = </font>DateToStr<font color="#000080">(</font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Available&quot;</font><font color="#000080">)
            -&gt;</font>AsDateTime<font color="#000080">); </font><font color="#008000">//存续期限
        </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">7</font><font color="#000080">][</font>i<font color="#000080">] = </font>DateToStr<font color="#000080">(</font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;CheckOff&quot;</font><font color="#000080">)
            -&gt;</font>AsDateTime<font color="#000080">); </font><font color="#008000">//注销期限
        </font>q<font color="#000080">-&gt;</font>Next<font color="#000080">();
    }
}

</font><font color="#008000">//------------------------------------------------------------------------
/*
自定义函数:
函数说明:
//显示房屋状况
 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>ShowP_PropertyHouseFun<font color="#000080">()
{
    </font>AnsiString sSql<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select * from P_HouseProperty where Paper_NO='&quot; </font><font color="#000080">+ </font>edtPaper_No<font color="#000080">-&gt;</font>Text
        <font color="#000080">+ </font><font color="#800000">&quot;'&quot;</font><font color="#000080">;
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    </font><font color="#008000">//清空房屋状况StringGrid控件
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>gridPropertyHourse<font color="#000080">-&gt;</font>RowCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>j <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>j <font color="#000080">&lt; </font>gridPropertyHourse<font color="#000080">-&gt;</font>ColCount<font color="#000080">; </font>j<font color="#000080">++)
        {
            </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font>j<font color="#000080">][</font>i<font color="#000080">] = </font><font color="#800000">&quot;&quot;</font><font color="#000080">;
        }
    }
    </font>q<font color="#000080">-&gt;</font>First<font color="#000080">();
    </font>m_nHourseNum <font color="#000080">= </font>q<font color="#000080">-&gt;</font>RecordCount<font color="#000080">;
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>q<font color="#000080">-&gt;</font>RecordCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">0</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Building_NO&quot;</font><font color="#000080">)
            -&gt;</font>AsString<font color="#000080">; </font><font color="#008000">//栋号
        </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">1</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Doorplate_NO&quot;</font><font color="#000080">)
            -&gt;</font>AsString<font color="#000080">; </font><font color="#008000">//房号
        </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">2</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Room&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;
            </font><font color="#008000">//间数
        </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">3</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Structure&quot;</font><font color="#000080">)
            -&gt;</font>AsString<font color="#000080">; </font><font color="#008000">//结构
        </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">4</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Floor&quot;</font><font color="#000080">)-&gt;</font>AsInteger<font color="#000080">;
            </font><font color="#008000">//层数
        </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">5</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Structure_Area&quot;</font><font color="#000080">)
            -&gt;</font>AsFloat<font color="#000080">; </font><font color="#008000">//结构面积
        </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font><font color="#800080">6</font><font color="#000080">][</font>i<font color="#000080">] = </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Note&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
            </font><font color="#008000">//备注
        </font>q<font color="#000080">-&gt;</font>Next<font color="#000080">();
    }
}

</font><font color="#008000">/*
自定义函数:
函数说明:
获取建筑面积
 */
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>ShowGroundPropertyFun<font color="#000080">()
{
    </font>AnsiString sSql<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select * from P_GroundProperty where Paper_NO='&quot; </font><font color="#000080">+ </font>edtPaper_No
        <font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;'&quot;</font><font color="#000080">;
    </font>ResultSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    </font><font color="#0000FF">if </font><font color="#000080">(!</font>q<font color="#000080">-&gt;</font>IsEmpty<font color="#000080">())
    {
        </font>edtFile<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;File_NO_Head&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">; </font><font color="#008000">//土地字
        </font>edtFileNo<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;File_NO&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">; </font><font color="#008000">//土地号
        </font>edtUsedAreaM2<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;UsedAreaM2&quot;</font><font color="#000080">)-&gt;</font>AsFloat<font color="#000080">; </font><font color="#008000">//土地面积
        </font>edtUsedArea<font color="#000080">-&gt;</font>Text <font color="#000080">= </font>q<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;UsedArea&quot;</font><font color="#000080">)-&gt;</font>AsFloat<font color="#000080">; </font><font color="#008000">//土地亩
    </font><font color="#000080">}
}

</font><font color="#008000">//-------------------------------------------------------------------------
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>qryIndexAfterScroll<font color="#000080">(</font>TDataSet <font color="#000080">*</font>DataSet<font color="#000080">)
{
    </font>ClearFormFun<font color="#000080">();
    </font><font color="#008000">//显示所有权
    </font>ShowProperty_PaperFun<font color="#000080">();

    </font><font color="#008000">//显示房屋状况
    </font>ShowP_PropertyHouseFun<font color="#000080">();
    </font><font color="#008000">//显示他项权利摘要
    </font>ShowP_OtherPropertyFun<font color="#000080">();
    </font><font color="#008000">//显示契税摘要
    </font>ShowP_Contract_TaxFun<font color="#000080">();
    </font><font color="#008000">//显示供有权人摘要
    </font>ShowShareProperty_PaperFun<font color="#000080">();
    </font><font color="#008000">//显示土地信息
    </font>ShowGroundPropertyFun<font color="#000080">();
    </font><font color="#0000FF">if </font><font color="#000080">(</font>DataSet<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">)-&gt;</font>AsString <font color="#000080">!= </font><font color="#800000">&quot;&quot;</font><font color="#000080">)
    {
        </font>qryPicture<font color="#000080">-&gt;</font>Close<font color="#000080">();
        </font>qryPicture<font color="#000080">-&gt;</font>SQL<font color="#000080">-&gt;</font>Text <font color="#000080">=
            </font><font color="#800000">&quot;select top 1 * from P_HousePicture where Paper_NO='&quot; </font><font color="#000080">+ </font>DataSet
            <font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">)-&gt;</font>AsString <font color="#000080">+ </font><font color="#800000">&quot;'&quot;</font><font color="#000080">;
        ;
        </font>qryPicture<font color="#000080">-&gt;</font>Open<font color="#000080">();
    }
}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>actEditExecute<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font>Application<font color="#000080">-&gt;</font>CreateForm<font color="#000080">(</font><font color="#0000FF">__classid</font><font color="#000080">(</font>TfmUpdate<font color="#000080">), &amp;</font>fmUpdate<font color="#000080">);
    </font>fmUpdate<font color="#000080">-&gt;</font>ShowModal<font color="#000080">();
}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>actDeleteExecute<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font>AnsiString sSql<font color="#000080">;
    </font>TADOQuery <font color="#000080">*</font>q<font color="#000080">(</font>dmData<font color="#000080">-&gt;</font>qry<font color="#000080">);
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;update Property_Paper  set FNO ='1' where Paper_NO='&quot; </font><font color="#000080">+ </font>edtPaper_No
        <font color="#000080">-&gt;</font>Text <font color="#000080">+ </font><font color="#800000">&quot;'&quot;</font><font color="#000080">;
    </font>ExecuteSql<font color="#000080">(</font>q<font color="#000080">, </font>sSql<font color="#000080">);
    </font>sSql <font color="#000080">= </font><font color="#800000">&quot;select * from Property_Paper where FNO ='0'&quot;</font><font color="#000080">;
    </font>ExecuteSql<font color="#000080">(</font>qryIndex<font color="#000080">, </font>sSql<font color="#000080">);
    </font>qryIndex<font color="#000080">-&gt;</font>Active <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">;
}

</font><font color="#008000">//---------------------------------------------------------------------------
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>edtLocateKeyPress<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">, </font><font color="#0000FF">char </font><font color="#000080">&amp;</font>Key<font color="#000080">)
{
    </font>TLocateOptions Opts<font color="#000080">;

    </font>Opts<font color="#000080">.</font>Clear<font color="#000080">();
    </font>Opts <font color="#000080">&lt;&lt; </font>loPartialKey<font color="#000080">;
    </font>Variant locvalue<font color="#000080">;
    </font><font color="#0000FF">if </font><font color="#000080">(</font>Key <font color="#000080">== </font><font color="#800080">13</font><font color="#000080">)
    {
        </font>locvalue <font color="#000080">= </font>Variant<font color="#000080">(</font>edtLocate<font color="#000080">-&gt;</font>Text<font color="#000080">);
        </font>qryIndex<font color="#000080">-&gt;</font>Locate<font color="#000080">(</font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">, </font>locvalue<font color="#000080">, </font>Opts<font color="#000080">);
    }
}

</font><font color="#008000">//---------------------------------------------------------------------------


</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>cmbMakerKeyPress<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">, </font><font color="#0000FF">char </font><font color="#000080">&amp;</font>Key<font color="#000080">)
{
    </font>Key <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>cmbCheckerKeyPress<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">, </font><font color="#0000FF">char </font><font color="#000080">&amp;</font>Key<font color="#000080">)
{
    </font>Key <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>cmbPropertyRightKeyPress<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">, </font><font color="#0000FF">char </font><font color="#000080">&amp;</font>Key<font color="#000080">)
{
    </font><font color="#008000">// Key = 0;
</font><font color="#000080">}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>cmbPropertyRightChange<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font><font color="#008000">//  cmbPropertyRight-&gt;Text = &quot;所有人&quot;;
</font><font color="#000080">}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>cmbTaxTypeKeyPress<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">, </font><font color="#0000FF">char </font><font color="#000080">&amp;</font>Key<font color="#000080">)
{
    </font>Key <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>cmbTaxRaceKeyPress<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">, </font><font color="#0000FF">char </font><font color="#000080">&amp;</font>Key<font color="#000080">)
{
    </font>Key <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>cmbManageUnitKeyPress<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">, </font><font color="#0000FF">char </font><font color="#000080">&amp;</font>Key<font color="#000080">)
{
    </font>Key <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>edtFileKeyPress<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">, </font><font color="#0000FF">char </font><font color="#000080">&amp;</font>Key<font color="#000080">)
{
    </font>Key <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">;
}

</font><font color="#008000">//---------------------------------------------------------------------------
/*
自定义函数
函数说明：
用来判断在提交的之前检查数据的有效性
 */

</font><font color="#0000FF">bool __fastcall </font>TfmPPaper<font color="#000080">::</font>EnsureDatAvalidFun<font color="#000080">()
{
    </font><font color="#0000FF">if </font><font color="#000080">(</font>edtOwner<font color="#000080">-&gt;</font>Text <font color="#000080">== </font><font color="#800000">&quot;&quot;</font><font color="#000080">)
    {
        ::</font>MessageBox<font color="#000080">(</font><font color="#0000FF">this</font><font color="#000080">-&gt;</font>Handle<font color="#000080">, </font><font color="#800000">&quot;所有权人姓名不能为空！&quot;</font><font color="#000080">, </font><font color="#800000">&quot;警告&quot;</font><font color="#000080">,
            </font>MB_ICONERROR<font color="#000080">);
        </font><font color="#0000FF">return false</font><font color="#000080">;
    }
    </font><font color="#0000FF">if </font><font color="#000080">(</font>cmbMaker<font color="#000080">-&gt;</font>Text <font color="#000080">== </font><font color="#800000">&quot;&quot;</font><font color="#000080">)
    {
        ::</font>MessageBox<font color="#000080">(</font><font color="#0000FF">this</font><font color="#000080">-&gt;</font>Handle<font color="#000080">, </font><font color="#800000">&quot;缮证人姓名不能为空！&quot;</font><font color="#000080">, </font><font color="#800000">&quot;警告&quot;</font><font color="#000080">, </font>MB_ICONERROR<font color="#000080">)
            ;
        </font><font color="#0000FF">return false</font><font color="#000080">;
    }
    </font><font color="#0000FF">if </font><font color="#000080">(</font>cmbChecker<font color="#000080">-&gt;</font>Text <font color="#000080">== </font><font color="#800000">&quot;&quot;</font><font color="#000080">)
    {
        ::</font>MessageBox<font color="#000080">(</font><font color="#0000FF">this</font><font color="#000080">-&gt;</font>Handle<font color="#000080">, </font><font color="#800000">&quot;校对人姓名不能为空！&quot;</font><font color="#000080">, </font><font color="#800000">&quot;警告&quot;</font><font color="#000080">, </font>MB_ICONERROR<font color="#000080">)
            ;
        </font><font color="#0000FF">return false</font><font color="#000080">;
    }
    </font><font color="#0000FF">if </font><font color="#000080">(</font>cmbManageUnit<font color="#000080">-&gt;</font>Text <font color="#000080">== </font><font color="#800000">&quot;&quot;</font><font color="#000080">)
    {
        ::</font>MessageBox<font color="#000080">(</font><font color="#0000FF">this</font><font color="#000080">-&gt;</font>Handle<font color="#000080">, </font><font color="#800000">&quot;填发机关不能为空！&quot;</font><font color="#000080">, </font><font color="#800000">&quot;警告&quot;</font><font color="#000080">, </font>MB_ICONERROR<font color="#000080">);
        </font><font color="#0000FF">return false</font><font color="#000080">;
    }
}

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>ControlReadOnlyFun<font color="#000080">()
{
    </font>edtPaper_No<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">;
    </font>edtPaper_No<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>edtOwner<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">; </font><font color="#008000">//所有权人
    </font>edtOwner<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>edtPropertyRight<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">;
    </font>edtPropertyRight<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">; </font><font color="#008000">//所有权性质
    </font>edtOwnerList<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">; </font><font color="#008000">//共有人
    </font>edtOwnerList<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>edtPosition<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">; </font><font color="#008000">//房屋坐落
    </font>edtPosition<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>edtGround_No<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">; </font><font color="#008000">//地号
    </font>edtGround_No<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font><font color="#008000">//房屋状况
    </font>gridPropertyHourse<font color="#000080">-&gt;</font>Options <font color="#000080">&gt;&gt; </font>goEditing<font color="#000080">;
    </font>gridPropertyHourse<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>memRemark<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">;
    </font>memRemark<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">; </font><font color="#008000">//附记
    </font>cmbMaker<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>cmbChecker<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">; </font><font color="#008000">//校 对 人

     /*----------------------------*/ //共有权人列表
    </font>gridOwnerList<font color="#000080">-&gt;</font>Options <font color="#000080">&gt;&gt; </font>goEditing<font color="#000080">;
    </font>gridOwnerList<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;

    </font>EdtPrice<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">; </font><font color="#008000">//契价
    </font>EdtPrice<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font><font color="#008000">//契价种类
    </font>cmbTaxRace<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">; </font><font color="#008000">//契税税率
    </font>edtTax<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>edtTax<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">; </font><font color="#008000">//纳税金额
    </font>edtNote<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">; </font><font color="#008000">//备 注
    //他项权利摘要
    </font>gridOtherProperty<font color="#000080">-&gt;</font>Options <font color="#000080">&gt;&gt; </font>goEditing<font color="#000080">;
    </font>gridOtherProperty<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>edtUsedAreaM2<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">; </font><font color="#008000">//使用土地面积
    </font>edtUsedAreaM2<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>edtUsedArea<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">; </font><font color="#008000">//平方米合  亩

    </font>edtUsedArea<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font><font color="#008000">// edtFile-&gt;Text = &quot;&quot;;       //土地使用证字号
    </font>edtFileNo<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">true</font><font color="#000080">;
    </font>edtFileNo<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>cmbManageUnit<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;

    </font>cmbTaxType<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>cmbTaxRace<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>dataStartData<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>dataSendOutDate<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;
    </font>edtFile<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clBtnFace<font color="#000080">;


}

</font><font color="#008000">//----------------------------------------------------------------
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>ControlWriteFun<font color="#000080">()
{
    </font>edtOwner<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//所有权人
    </font>edtOwner<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;


    </font>edtPosition<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//房屋坐落
    </font>edtPosition<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>edtGround_No<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//地号
    </font>edtGround_No<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font><font color="#008000">//房屋状况
    </font>gridPropertyHourse<font color="#000080">-&gt;</font>Options <font color="#000080">&lt;&lt; </font>goEditing<font color="#000080">;
    </font>gridPropertyHourse<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>memRemark<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">;
    </font>memRemark<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">; </font><font color="#008000">//附记
    </font>cmbMaker<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>cmbChecker<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">; </font><font color="#008000">//校 对 人

     /*----------------------------*/ //共有权人列表
    </font>gridOwnerList<font color="#000080">-&gt;</font>Options <font color="#000080">&lt;&lt; </font>goEditing<font color="#000080">;
    </font>gridOwnerList<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>EdtPrice<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//契价
    </font>EdtPrice<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font><font color="#008000">//契价种类

    </font>cmbTaxRace<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">; </font><font color="#008000">//契税税率
    </font>cmbTaxType<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>cmbTaxRace<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>edtTax<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//纳税金额
    </font>edtTax<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>edtNote<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">; </font><font color="#008000">//备 注
    //他项权利摘要
    </font>gridOtherProperty<font color="#000080">-&gt;</font>Options <font color="#000080">&lt;&lt; </font>goEditing<font color="#000080">;
    </font>gridOtherProperty<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;

    </font>edtUsedAreaM2<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//使用土地面积
    </font>edtUsedAreaM2<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;

    </font>edtUsedArea<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">; </font><font color="#008000">//平方米合  亩
    </font>edtUsedArea<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;

    </font>edtFileNo<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>edtFileNo<font color="#000080">-&gt;</font>ReadOnly <font color="#000080">= </font><font color="#0000FF">false</font><font color="#000080">;
    </font>cmbManageUnit<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>dataStartData<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
    </font>dataSendOutDate<font color="#000080">-&gt;</font>Color <font color="#000080">= </font>clWindow<font color="#000080">;
}


</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>actSearchExecute<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font>TLocateOptions Opts<font color="#000080">;
    </font>Opts<font color="#000080">.</font>Clear<font color="#000080">();
    </font>Opts <font color="#000080">&lt;&lt; </font>loPartialKey<font color="#000080">;
    </font>Variant locvalue<font color="#000080">;
    </font>locvalue <font color="#000080">= </font>Variant<font color="#000080">(</font>edtLocate<font color="#000080">-&gt;</font>Text<font color="#000080">);
    </font>qryIndex<font color="#000080">-&gt;</font>Locate<font color="#000080">(</font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">, </font>locvalue<font color="#000080">, </font>Opts<font color="#000080">);

}

</font><font color="#008000">//---------------------------------------------------------------------------





</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>ClearFormFun<font color="#000080">()
{

    </font><font color="#008000">//界面清空
    </font>edtPaper_No<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//桂房证字号清空
    </font>edtOwner<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//所有权人
    //cmbPropertyRight-&gt;Text = &quot;&quot;;      //所有权性质
    </font>edtOwnerList<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//共有人
    </font>edtPosition<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//房屋坐落
    </font>edtGround_No<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//地号
    //房屋状况
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>gridPropertyHourse<font color="#000080">-&gt;</font>RowCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>j <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>j <font color="#000080">&lt; </font>gridPropertyHourse<font color="#000080">-&gt;</font>ColCount<font color="#000080">; </font>j<font color="#000080">++)
        {
            </font>gridPropertyHourse<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font>j<font color="#000080">][</font>i<font color="#000080">] = </font><font color="#800000">&quot;&quot;</font><font color="#000080">;
        }
    }
    </font>memRemark<font color="#000080">-&gt;</font>Lines<font color="#000080">-&gt;</font>Clear<font color="#000080">(); </font><font color="#008000">//附记
    </font>cmbMaker<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//缮 证 人
    </font>cmbChecker<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//校 对 人

     /*----------------------------*/ //共有权人列表
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>gridOwnerList<font color="#000080">-&gt;</font>RowCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>j <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>j <font color="#000080">&lt; </font>gridOwnerList<font color="#000080">-&gt;</font>ColCount<font color="#000080">; </font>j<font color="#000080">++)
        {
            </font>gridOwnerList<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font>j<font color="#000080">][</font>i<font color="#000080">] = </font><font color="#800000">&quot;&quot;</font><font color="#000080">;
        }
    }
    </font>EdtPrice<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//契价
    </font>cmbTaxType<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//契价种类
    </font>cmbTaxRace<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//契税税率
    </font>edtTax<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//纳税金额
    </font>edtNote<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//备 注
    //他项权利摘要
    </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>i <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>i <font color="#000080">&lt; </font>gridOtherProperty<font color="#000080">-&gt;</font>RowCount<font color="#000080">; </font>i<font color="#000080">++)
    {
        </font><font color="#0000FF">for </font><font color="#000080">(</font><font color="#0000FF">int </font>j <font color="#000080">= </font><font color="#800080">0</font><font color="#000080">; </font>j <font color="#000080">&lt; </font>gridOtherProperty<font color="#000080">-&gt;</font>ColCount<font color="#000080">; </font>j<font color="#000080">++)
        {
            </font>gridOtherProperty<font color="#000080">-&gt;</font>Cells<font color="#000080">[</font>j<font color="#000080">][</font>i<font color="#000080">] = </font><font color="#800000">&quot;&quot;</font><font color="#000080">;
        }
    }
    </font>edtUsedAreaM2<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//使用土地面积
    </font>edtUsedArea<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">; </font><font color="#008000">//平方米合  亩
    // edtFile-&gt;Text = &quot;&quot;;       //土地使用证字号
    </font>edtFileNo<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">;
    </font>cmbManageUnit<font color="#000080">-&gt;</font>Text <font color="#000080">= </font><font color="#800000">&quot;&quot;</font><font color="#000080">;


}

</font><font color="#008000">//---------------------------------------------------------------------------
</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>dimgPicture1DblClick<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font><font color="#0000FF">if </font><font color="#000080">(</font>qryPicture<font color="#000080">-&gt;</font>IsEmpty<font color="#000080">())
    {
        </font>qryPicture<font color="#000080">-&gt;</font>Append<font color="#000080">();
        </font>qryPicture<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">)-&gt;</font>Value <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(
            </font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
    }
    </font><font color="#0000FF">else
    </font><font color="#000080">{
        </font>qryPicture<font color="#000080">-&gt;</font>Edit<font color="#000080">();
    }

    </font><font color="#0000FF">if </font><font color="#000080">(</font>openDgPic<font color="#000080">-&gt;</font>Execute<font color="#000080">())
    {
        </font><font color="#0000FF">try
        </font><font color="#000080">{
            </font>TBlobField <font color="#000080">*</font>Field <font color="#000080">= (</font>TBlobField<font color="#000080">*)</font>qryPicture<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Picture1&quot;</font><font color="#000080">)
                ;
            </font>Field<font color="#000080">-&gt;</font>LoadFromFile<font color="#000080">(</font>openDgPic<font color="#000080">-&gt;</font>FileName<font color="#000080">);
            </font>qryPicture<font color="#000080">-&gt;</font>Post<font color="#000080">();
        }
        </font><font color="#0000FF">__finally</font><font color="#000080">{}
    }
}

</font><font color="#008000">//---------------------------------------------------------------------------

</font><font color="#0000FF">void __fastcall </font>TfmPPaper<font color="#000080">::</font>dimgPicture2DblClick<font color="#000080">(</font>TObject <font color="#000080">*</font>Sender<font color="#000080">)
{
    </font><font color="#0000FF">if </font><font color="#000080">(</font>qryPicture<font color="#000080">-&gt;</font>IsEmpty<font color="#000080">())
    {
        </font>qryPicture<font color="#000080">-&gt;</font>Append<font color="#000080">();
        </font>qryPicture<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">)-&gt;</font>Value <font color="#000080">= </font>qryIndex<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(
            </font><font color="#800000">&quot;Paper_NO&quot;</font><font color="#000080">)-&gt;</font>AsString<font color="#000080">;
    }
    </font><font color="#0000FF">else
    </font><font color="#000080">{
        </font>qryPicture<font color="#000080">-&gt;</font>Edit<font color="#000080">();
    }
    </font><font color="#0000FF">if </font><font color="#000080">(</font>openDgPic<font color="#000080">-&gt;</font>Execute<font color="#000080">())
    {
        </font><font color="#0000FF">try
        </font><font color="#000080">{
            </font>TBlobField <font color="#000080">*</font>Field <font color="#000080">= (</font>TBlobField<font color="#000080">*)</font>qryPicture<font color="#000080">-&gt;</font>FieldByName<font color="#000080">(</font><font color="#800000">&quot;Picture2&quot;</font><font color="#000080">)
                ;
            </font>Field<font color="#000080">-&gt;</font>LoadFromFile<font color="#000080">(</font>openDgPic<font color="#000080">-&gt;</font>FileName<font color="#000080">);
            </font>qryPicture<font color="#000080">-&gt;</font>Post<font color="#000080">();
        }
        </font><font color="#0000FF">__finally</font><font color="#000080">{}
    }
}

</font><font color="#008000">//---------------------------------------------------------------------------
</font></font>
</code></pre>
</body>
</html>